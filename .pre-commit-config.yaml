# Pre-commit hooks for secret detection and code quality
# Install: pip install pre-commit && pre-commit install
# Run manually: pre-commit run --all-files

repos:
  # Secret detection with gitleaks
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.18.1
    hooks:
      - id: gitleaks

  # Detect common secret patterns
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # Prevent commits with large files
      - id: check-added-large-files
        args: ['--maxkb=500']

      # Check for files that would conflict on case-insensitive filesystems
      - id: check-case-conflict

      # Ensure files end with newline
      - id: end-of-file-fixer
        exclude: '\.min\.(js|css)$'

      # Remove trailing whitespace
      - id: trailing-whitespace
        exclude: '\.min\.(js|css)$'

      # Check JSON syntax
      - id: check-json

      # Check YAML syntax
      - id: check-yaml
        args: ['--allow-multiple-documents']

      # Detect AWS credentials
      - id: detect-aws-credentials
        args: ['--allow-missing-credentials']

      # Detect private keys
      - id: detect-private-key

  # TypeScript/JavaScript checks
  - repo: local
    hooks:
      - id: typescript-check
        name: TypeScript Check
        entry: bash -c 'for dir in workers/*/; do if [ -f "$dir/tsconfig.json" ]; then cd "$dir" && npx tsc --noEmit && cd -; fi; done'
        language: system
        files: '\.(ts|tsx)$'
        pass_filenames: false

# Gitleaks configuration
# Custom patterns can be added in .gitleaks.toml if needed
