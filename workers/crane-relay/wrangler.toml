name = "crane-relay-staging"
main = "src/index.ts"
compatibility_date = "2025-12-15"
compatibility_flags = ["nodejs_compat"]

[vars]
# V1 defaults (backwards compatibility)
GITHUB_OWNER = "durganfieldguide"
GITHUB_REPO = "dfg-console"

# V2 vars
GH_APP_ID = "2619905"
GH_INSTALLATIONS_JSON = '{"durganfieldguide":"103277966","venturecrane":"104223482","siliconcrane":"104223351","kidexpenses":"106532992"}'
LABEL_RULES_JSON = '{"qa.result_submitted":{"PASS":{"add":["status:verified"],"remove":["status:qa","needs:qa"]},"PASS_UNVERIFIED":{"add":[],"remove":[]},"FAIL":{"add":["needs:dev"],"remove":["needs:qa"]},"FAIL_UNCONFIRMED":{"add":[],"remove":[]},"BLOCKED":{"add":["status:blocked"],"remove":["status:qa","needs:qa"]}},"dev.update":{"_":{"add":["status:qa","needs:qa"],"remove":["status:in-progress","needs:dev"]}}}'

# Secrets (set via `wrangler secret put`):
# - RELAY_TOKEN, RELAY_SHARED_SECRET, GH_PRIVATE_KEY_PEM, GEMINI_API_KEY, GH_WEBHOOK_SECRET

[[d1_databases]]
binding = "DB"
database_name = "dfg-relay-staging"
database_id = "d8bda289-1f45-4f17-9fc4-db8ddaf6b7bf"

[[r2_buckets]]
binding = "EVIDENCE_BUCKET"
bucket_name = "dfg-relay-evidence-staging"

[env.production]
name = "crane-relay"

[env.production.vars]
# V1 defaults (backwards compatibility)
GITHUB_OWNER = "durganfieldguide"
GITHUB_REPO = "dfg-console"

# V2 vars
GH_APP_ID = "2619905"
GH_INSTALLATIONS_JSON = '{"durganfieldguide":"103277966","venturecrane":"104223482","siliconcrane":"104223351","kidexpenses":"106532992"}'
LABEL_RULES_JSON = '{"qa.result_submitted":{"PASS":{"add":["status:verified"],"remove":["status:qa","needs:qa"]},"PASS_UNVERIFIED":{"add":[],"remove":[]},"FAIL":{"add":["needs:dev"],"remove":["needs:qa"]},"FAIL_UNCONFIRMED":{"add":[],"remove":[]},"BLOCKED":{"add":["status:blocked"],"remove":["status:qa","needs:qa"]}},"dev.update":{"_":{"add":["status:qa","needs:qa"],"remove":["status:in-progress","needs:dev"]}}}'

[[env.production.d1_databases]]
binding = "DB"
database_name = "dfg-relay"
database_id = "fb2c5649-99af-4a99-806b-f7e29690d173"

[[env.production.r2_buckets]]
binding = "EVIDENCE_BUCKET"
bucket_name = "dfg-relay-evidence"
