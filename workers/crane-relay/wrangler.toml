name = "crane-relay"
main = "src/index.ts"
compatibility_date = "2025-12-15"
compatibility_flags = ["nodejs_compat"]

[vars]
# V1 defaults (backwards compatibility)
GITHUB_OWNER = "venturecrane"
GITHUB_REPO = "dfg-console"

# V2 vars
GH_APP_ID = "2619905"
GH_INSTALLATIONS_JSON = '{"venturecrane":"104223482"}'
LABEL_RULES_JSON = '{"qa.result_submitted":{"PASS":{"add":["status:verified"],"remove":["status:qa","needs:qa"]},"PASS_UNVERIFIED":{"add":[],"remove":[]},"FAIL":{"add":["needs:dev"],"remove":["needs:qa"]},"FAIL_UNCONFIRMED":{"add":[],"remove":[]},"BLOCKED":{"add":["status:blocked"],"remove":["status:qa","needs:qa"]}},"dev.update":{"_":{"add":["status:qa","needs:qa"],"remove":["status:in-progress","needs:dev"]}}}'

# Secrets (set via `wrangler secret put`):
# - RELAY_TOKEN: Auth for V1 endpoints (= CRANE_ADMIN_KEY)
# - RELAY_SHARED_SECRET: Auth for V2 endpoints (= CRANE_ADMIN_KEY)
# - GH_PRIVATE_KEY_PEM: GitHub App private key (for installation tokens)
# - GEMINI_API_KEY: Gemini Developer API key (for issue classification)
# - GH_WEBHOOK_SECRET: GitHub webhook secret (for signature validation)
# Note: GITHUB_TOKEN (PAT) is deprecated - V1 now uses GitHub App tokens

[[d1_databases]]
binding = "DB"
database_name = "dfg-relay"
database_id = "fb2c5649-99af-4a99-806b-f7e29690d173"

[[r2_buckets]]
binding = "EVIDENCE_BUCKET"
bucket_name = "dfg-relay-evidence"
